D:\anaconda3\envs\torch2.8\python.exe D:\泰迪杯\B题-全部数据\JerkTrainingSet\CNN_LSTM_JERK.py 
使用的设备: cuda
检查可用数据文件 (P001-P100)...
找到 100 个有效数据文件。

数据集划分:
  训练: 70, 验证: 10, 测试: 20

加载训练数据以拟合预处理器...
加载训练文件: 100%|██████████| 70/70 [08:15<00:00,  7.08s/it]
从文件名中提取到 70 个唯一的训练集 PID。
从文件名中提取到 10 个唯一的验证集 PID。
从文件名中提取到 20 个唯一的测试集 PID。
合并训练数据...
合并训练数据形状: (282542982, 9)
拟合 StandardScaler...
Scaler 已在传感器+Jerk特征上拟合。
拟合 Sex Encoder...
Sex Encoder 已拟合 (类别: ['F' 'M'])。
拟合 Age Encoder...
Age Encoder 已拟合 (类别: ['18-29' '30-37' '38-52' '53+'])。
最终人口统计学特征数: 6
最终序列总特征数 (传感器[含Jerk] + 人口统计): 13

加载验证数据...
加载验证文件: 100%|██████████| 10/10 [01:22<00:00,  8.21s/it]
合并验证数据形状: (46523796, 9)
加载测试文件:   0%|          | 0/20 [00:00<?, ?it/s]
加载测试数据...
加载测试文件: 100%|██████████| 20/20 [02:27<00:00,  7.36s/it]
合并测试数据形状: (83480321, 9)

创建数据集...
为 70 个唯一 PID 预编码人口统计学特征...
预编码人口统计特征: 100%|██████████| 70/70 [00:00<00:00, 1342.13it/s]
人口统计特征预编码完成。
预编码人口统计特征: 100%|██████████| 10/10 [00:00<00:00, 1264.37it/s]
为 10 个唯一 PID 预编码人口统计学特征...
人口统计特征预编码完成。
预编码人口统计特征: 100%|██████████| 20/20 [00:00<00:00, 1332.77it/s]
为 20 个唯一 PID 预编码人口统计学特征...
人口统计特征预编码完成。
使用 0 个数据加载工作进程。

初始化模型 (序列输入特征: 13)...

模型架构:
总可训练参数: 599,685
计算类别权重...
计算近似类别权重...
原始数据类别分布:
  类别 0: 76255260 (26.99%)
  类别 1: 107007980 (37.87%)
  类别 2: 60214668 (21.31%)
  类别 3: 37485964 (13.27%)
  类别 4: 1579110 (0.56%)
近似类别权重: ['0.7410', '0.5281', '0.9385', '1.5075', '35.7851']
使用加权损失 (权重设备: cuda:0)。
周期 1/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]使用 AdamW 优化器 (LR=0.001, WD=1e-05)。
使用 ReduceLROnPlateau LR 调度器 (基于验证准确率, factor=0.2, patience=5)。

--- 开始训练 ---
周期 1/50 [训练中]: 100%|██████████| 3532/3532 [06:37<00:00,  8.87it/s, 损失=1.0602, 准确率=0.2273, LR=1.0e-03]
周期 2/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 1/50 => 训练损失: 1.0511, 训练准确率: 0.5443 | 验证损失: 0.8511, 验证准确率: 0.6329
*** 新的最佳验证准确率: 0.6329 (周期 1) ***
周期 2/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.83it/s, 损失=0.9743, 准确率=0.4091, LR=1.0e-03]
周期 3/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 2/50 => 训练损失: 0.8302, 训练准确率: 0.6614 | 验证损失: 0.7355, 验证准确率: 0.6958
*** 新的最佳验证准确率: 0.6958 (周期 2) ***
周期 3/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.0474, 准确率=0.2727, LR=1.0e-03]
周期 4/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 3/50 => 训练损失: 0.7756, 训练准确率: 0.6852 | 验证损失: 0.7503, 验证准确率: 0.6772
验证准确率未提升。连续未提升周期: 1/10。
周期 4/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.1052, 准确率=0.0909, LR=1.0e-03]
周期 5/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 4/50 => 训练损失: 0.7511, 训练准确率: 0.6942 | 验证损失: 0.7687, 验证准确率: 0.6556
验证准确率未提升。连续未提升周期: 2/10。
周期 5/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.83it/s, 损失=1.1327, 准确率=0.0909, LR=1.0e-03]
周期 6/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 5/50 => 训练损失: 0.7205, 训练准确率: 0.7070 | 验证损失: 0.7342, 验证准确率: 0.6488
验证准确率未提升。连续未提升周期: 3/10。
周期 6/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.1494, 准确率=0.0455, LR=1.0e-03]
周期 7/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 6/50 => 训练损失: 0.7033, 训练准确率: 0.7156 | 验证损失: 0.7215, 验证准确率: 0.6588
验证准确率未提升。连续未提升周期: 4/10。
周期 7/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0656, 准确率=0.1818, LR=1.0e-03]
周期 8/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 7/50 => 训练损失: 0.6912, 训练准确率: 0.7218 | 验证损失: 0.7183, 验证准确率: 0.6776
验证准确率未提升。连续未提升周期: 5/10。
周期 8/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=0.9939, 准确率=0.4091, LR=1.0e-03]
周期 9/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 8/50 => 训练损失: 0.6760, 训练准确率: 0.7242 | 验证损失: 0.6936, 验证准确率: 0.7007
*** 新的最佳验证准确率: 0.7007 (周期 8) ***
周期 9/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=1.1338, 准确率=0.0455, LR=1.0e-03]
周期 10/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 9/50 => 训练损失: 0.6682, 训练准确率: 0.7279 | 验证损失: 0.6973, 验证准确率: 0.6961
验证准确率未提升。连续未提升周期: 1/10。
周期 10/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.0555, 准确率=0.1364, LR=1.0e-03]
周期 11/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 10/50 => 训练损失: 0.6583, 训练准确率: 0.7308 | 验证损失: 0.6862, 验证准确率: 0.7070
*** 新的最佳验证准确率: 0.7070 (周期 10) ***
周期 11/50 [训练中]: 100%|██████████| 3532/3532 [06:40<00:00,  8.81it/s, 损失=1.1999, 准确率=0.0909, LR=1.0e-03]
周期 12/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 11/50 => 训练损失: 0.6471, 训练准确率: 0.7364 | 验证损失: 0.6937, 验证准确率: 0.6922
验证准确率未提升。连续未提升周期: 1/10。
周期 12/50 [训练中]: 100%|██████████| 3532/3532 [06:40<00:00,  8.82it/s, 损失=1.2982, 准确率=0.0455, LR=1.0e-03]
周期 13/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 12/50 => 训练损失: 0.6598, 训练准确率: 0.7343 | 验证损失: 0.7231, 验证准确率: 0.6770
验证准确率未提升。连续未提升周期: 2/10。
周期 13/50 [训练中]: 100%|██████████| 3532/3532 [06:40<00:00,  8.83it/s, 损失=1.1129, 准确率=0.0909, LR=1.0e-03]
周期 14/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 13/50 => 训练损失: 0.6585, 训练准确率: 0.7314 | 验证损失: 0.6709, 验证准确率: 0.6949
验证准确率未提升。连续未提升周期: 3/10。
周期 14/50 [训练中]: 100%|██████████| 3532/3532 [06:40<00:00,  8.82it/s, 损失=1.1277, 准确率=0.1364, LR=1.0e-03]
周期 15/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 14/50 => 训练损失: 0.6406, 训练准确率: 0.7398 | 验证损失: 0.6674, 验证准确率: 0.7000
验证准确率未提升。连续未提升周期: 4/10。
周期 15/50 [训练中]: 100%|██████████| 3532/3532 [06:40<00:00,  8.82it/s, 损失=1.1442, 准确率=0.1364, LR=1.0e-03]
周期 16/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 15/50 => 训练损失: 0.6265, 训练准确率: 0.7461 | 验证损失: 0.6869, 验证准确率: 0.6956
验证准确率未提升。连续未提升周期: 5/10。
周期 16/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.83it/s, 损失=1.0512, 准确率=0.0909, LR=1.0e-03]
周期 17/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 16/50 => 训练损失: 0.6323, 训练准确率: 0.7427 | 验证损失: 0.6684, 验证准确率: 0.6992
验证准确率未提升。连续未提升周期: 6/10。
周期 17/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.0527, 准确率=0.3182, LR=2.0e-04]
周期 18/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 17/50 => 训练损失: 0.6051, 训练准确率: 0.7516 | 验证损失: 0.6255, 验证准确率: 0.7474
*** 新的最佳验证准确率: 0.7474 (周期 17) ***
周期 18/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.87it/s, 损失=1.0322, 准确率=0.5000, LR=2.0e-04]
周期 19/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 18/50 => 训练损失: 0.5879, 训练准确率: 0.7588 | 验证损失: 0.6280, 验证准确率: 0.7461
验证准确率未提升。连续未提升周期: 1/10。
周期 19/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.87it/s, 损失=1.0901, 准确率=0.3636, LR=2.0e-04]
周期 20/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 19/50 => 训练损失: 0.5773, 训练准确率: 0.7631 | 验证损失: 0.6190, 验证准确率: 0.7524
*** 新的最佳验证准确率: 0.7524 (周期 19) ***
周期 20/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=1.1073, 准确率=0.3636, LR=2.0e-04]
周期 21/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 20/50 => 训练损失: 0.5683, 训练准确率: 0.7674 | 验证损失: 0.6199, 验证准确率: 0.7528
验证准确率未提升。连续未提升周期: 1/10。
周期 21/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0235, 准确率=0.4545, LR=2.0e-04]
周期 22/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 21/50 => 训练损失: 0.5579, 训练准确率: 0.7722 | 验证损失: 0.6224, 验证准确率: 0.7538
*** 新的最佳验证准确率: 0.7538 (周期 21) ***
周期 22/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0602, 准确率=0.4545, LR=2.0e-04]
周期 23/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 22/50 => 训练损失: 0.5505, 训练准确率: 0.7744 | 验证损失: 0.6140, 验证准确率: 0.7639
*** 新的最佳验证准确率: 0.7639 (周期 22) ***
周期 23/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=1.0642, 准确率=0.4091, LR=2.0e-04]
周期 24/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 23/50 => 训练损失: 0.5427, 训练准确率: 0.7786 | 验证损失: 0.6228, 验证准确率: 0.7592
验证准确率未提升。连续未提升周期: 1/10。
周期 24/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=0.9785, 准确率=0.4545, LR=2.0e-04]
周期 25/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 24/50 => 训练损失: 0.5360, 训练准确率: 0.7817 | 验证损失: 0.6278, 验证准确率: 0.7555
验证准确率未提升。连续未提升周期: 2/10。
周期 25/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0879, 准确率=0.2273, LR=2.0e-04]
周期 26/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 25/50 => 训练损失: 0.5299, 训练准确率: 0.7838 | 验证损失: 0.6349, 验证准确率: 0.7529
验证准确率未提升。连续未提升周期: 3/10。
周期 26/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=1.1067, 准确率=0.2273, LR=2.0e-04]
周期 27/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 26/50 => 训练损失: 0.5259, 训练准确率: 0.7865 | 验证损失: 0.6453, 验证准确率: 0.7491
验证准确率未提升。连续未提升周期: 4/10。
周期 27/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0688, 准确率=0.3636, LR=2.0e-04]
周期 28/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 27/50 => 训练损失: 0.5185, 训练准确率: 0.7888 | 验证损失: 0.6480, 验证准确率: 0.7469
验证准确率未提升。连续未提升周期: 5/10。
周期 28/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=1.0477, 准确率=0.3636, LR=2.0e-04]
周期 29/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 28/50 => 训练损失: 0.5169, 训练准确率: 0.7892 | 验证损失: 0.6599, 验证准确率: 0.7403
验证准确率未提升。连续未提升周期: 6/10。
周期 29/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=0.9879, 准确率=0.4545, LR=4.0e-05]
周期 30/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 29/50 => 训练损失: 0.5025, 训练准确率: 0.7963 | 验证损失: 0.6229, 验证准确率: 0.7635
验证准确率未提升。连续未提升周期: 7/10。
周期 30/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.84it/s, 损失=0.9749, 准确率=0.6364, LR=4.0e-05]
周期 31/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 30/50 => 训练损失: 0.4951, 训练准确率: 0.8000 | 验证损失: 0.6207, 验证准确率: 0.7636
验证准确率未提升。连续未提升周期: 8/10。
周期 31/50 [训练中]: 100%|██████████| 3532/3532 [06:38<00:00,  8.86it/s, 损失=1.0493, 准确率=0.4545, LR=4.0e-05]
周期 32/50 [训练中]:   0%|          | 0/3532 [00:00<?, ?it/s]
周期 31/50 => 训练损失: 0.4912, 训练准确率: 0.8009 | 验证损失: 0.6232, 验证准确率: 0.7625
验证准确率未提升。连续未提升周期: 9/10。
周期 32/50 [训练中]: 100%|██████████| 3532/3532 [06:39<00:00,  8.85it/s, 损失=1.0184, 准确率=0.5909, LR=4.0e-05]
                                                                                                  
周期 32/50 => 训练损失: 0.4888, 训练准确率: 0.8022 | 验证损失: 0.6217, 验证准确率: 0.7642
验证准确率未提升。连续未提升周期: 10/10。

--- 早停触发 ---
训练历史图已保存至: training_history_Attention_Jerk_ws10000_st2500_bs32_cf64_ks5_lh128_L2.png

--- 在测试集上评估 ---
                                                                                       
最终测试结果:
  损失: 0.7205
  准确率: 0.7098
最终模型状态已保存至: final_model_Attention_Jerk_ws10000_st2500_bs32_cf64_ks5_lh128_L2.pth

脚本执行完毕。

进程已结束，退出代码为 0
